---
import SliderButton from "./testimonials/SliderButton.astro";
import TestimonialCard from "./testimonials/TestimonialCard.astro";
import "swiper/css";

const { data } = Astro.props;
---

<section class="reviews container" id={data.id}>
  <header class="reviews__header">
    <h2 class="reviews__title title">{data.title}</h2>
    <div class="reviews__controls">
      <SliderButton direction="prev" disabled />
      <SliderButton direction="next" />
    </div>
  </header>
  <div class="swiper reviews__slider-wrap">
    <ul class="swiper-wrapper reviews__list">
      {
        data.list.map((item) => (
          <li class="swiper-slide reviews__item">
            <TestimonialCard data={item} />
          </li>
        ))
      }
    </ul>
  </div>
</section>

<script>
  import Swiper from "swiper";

  const swiper = new Swiper(".swiper", {
    slidesPerView: 3.4,
    freeMode: true,
    speed: 400,
    spaceBetween: 50,
  });

  const buttons = document.querySelectorAll(
    ".arrowbtn"
  ) as NodeListOf<HTMLButtonElement>;
  const prevBtn = Array.from(buttons).find(
    (btn) => btn.dataset.direction === "prev"
  );
  const nextBtn = Array.from(buttons).find(
    (btn) => btn.dataset.direction === "next"
  );

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const direction = btn.dataset.direction;

      if (direction === "prev") {
        swiper.slidePrev();
        nextBtn.disabled = false;
      }

      if (direction === "next") {
        swiper.slideNext();
        prevBtn.disabled = false;
      }
    });
  });

  swiper.on("reachBeginning", function () {
    prevBtn.disabled = true;
  });

  swiper.on("reachEnd", function () {
    nextBtn.disabled = true;
  });

  swiper.on("fromEdge", function () {
    if (swiper.swipeDirection === "next") {
      prevBtn.disabled = false;
    }

    if (swiper.swipeDirection === "prev") {
      nextBtn.disabled = false;
    }
  });
</script>

<style>
  .reviews {
    position: relative;
    z-index: 2;
    color: var(--text);
    background-color: var(--button-primary);
    padding-top: 33px;
    padding-bottom: 87px;
    border-radius: 56px 56px 0 0;
  }

  .reviews__header {
    display: flex;
    align-items: end;
    justify-content: space-between;
    margin-bottom: 53px;
  }

  .reviews__controls {
    display: flex;
    gap: 8px;
  }

  .reviews__slider-wrap {
    margin: 0 calc(var(--container-gutter) * -1);
    padding-left: var(--container-gutter);
    padding-right: var(--container-gutter);
  }

  .reviews__list {
    list-style: none;
    padding: 0;
  }

  .reviews__item {
    height: auto;
  }
</style>
